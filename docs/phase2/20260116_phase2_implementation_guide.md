# Foresto Phase 2+ 진행 가이드 (Phase 1 완료 기준)
작성일: 2026-01-15

본 문서는 **Phase 1(데이터 기반 시뮬레이션 인프라)**까지 완료된 상태에서, 다음 단계(Phase 2~)를 **운영 가능한 제품**으로 확장하기 위한 실행 가이드이다.  
핵심 원칙은 Phase 0에서 확정한 방향(비추천/시나리오 기반/손실·회복 중심/재현성)을 **기능·데이터·운영** 전 영역에 유지하는 것이다.

---

## 1. 다음 단계의 정의: Phase 2 = 운영·품질·확장·설명가능성
Phase 1이 “작동하는 파이프라인/엔진”이라면, Phase 2는 아래 4가지를 완성한다.

1) **데이터 신뢰성(Data Quality)**: 결측/휴장/수정주가/환율/배당 등 현실 데이터 이슈 대응  
2) **운영성(Operability)**: 모니터링, 장애 대응, 비용·성능 최적화, 보관정책 자동화  
3) **확장성(Scalability)**: 유니버스 확대, 시나리오/모델 버전 관리, 백테스트 성능 개선  
4) **설명가능성(Explainability)**: “왜 이 결과가 나왔는지”를 *추천이 아닌 방식*으로 설명

---

## 2. Phase 2 목표/KPI (완료 정의)
### 제품 KPI(사용자 관점)
- 시나리오별 결과 비교에서 **MDD/회복기간/최악구간**이 1급 지표로 유지
- “수익률”은 보조 지표로만 제공(기대수익률/권유 표현 금지)
- 동일 입력 → 동일 request_hash → 동일 결과(엔진 버전 포함)

### 운영 KPI(팀 관점)
- ETL/마트 생성 배치의 **성공률 99%+**(개발/스테이징 기준)
- 결측률/품질리포트 자동 생성 및 알림
- 시뮬레이션 평균 응답 시간/비용 목표치 설정 및 모니터링
- 파티션/TTL 자동화(수동 개입 최소화)

---

## 3. Phase 2 권장 Epic(티켓화 단위)
아래 Epics는 “규제/신뢰 리스크”와 “운영 리스크”를 먼저 낮추는 순서로 정렬되어 있다.

### Epic P2-A. 데이터 품질/정합성 프레임워크
**목표**: 가격/수익률/환율/배당/휴장일 이슈로 결과가 흔들리지 않도록 표준 규칙화

- P2-A1. 거래일 캘린더 테이블 도입(시장별) + 휴장일 처리 규칙 문서화  
- P2-A2. 수정주가/총수익률(Total Return) 정책 결정  
  - (선택) 수정종가 기반 / 배당 포함 총수익률 기반 중 1개를 “공식 모드”로 고정
- P2-A3. 결측 처리(Forward-fill 금지/허용 범위) 및 `데이터품질` 분류 확장(OK/MISSING/IMPUTED) 운영화
- P2-A4. 품질 리포트 자동 생성: 종목별 결측률, 이상치(급등락) 탐지, 적재 지연 경보

**산출물**
- `거래일캘린더`, `데이터품질리포트` 테이블(또는 뷰)  
- `docs/data_policy.md` (데이터 처리 정책 단일 소스)

### Epic P2-B. 시나리오/모델 거버넌스(버전·승인·배포)
**목표**: 시나리오가 “운영 콘텐츠”가 되도록 승인/배포/롤백이 가능해야 함

- P2-B1. 시나리오/포트폴리오 모델의 버전 관리
  - `시나리오정의`에 version/상태(DRAFT/ACTIVE/RETIRED) 추가
- P2-B2. 구성비 합(1.0) 및 제약 검증을 **서버에서 강제**
- P2-B3. 변경 이력(Audit) 저장: 누가/언제/무엇을 변경했는지
- P2-B4. 시뮬레이션 결과에 “시나리오 버전”을 함께 저장하여 재현성 강화

**산출물**
- Admin 전용 CRUD(최소) + 승인 플로우(간단히: DRAFT→ACTIVE)

### Epic P2-C. 시뮬레이션 엔진 고도화(현실 요소)
**목표**: 운영에서 문제 되는 핵심 요소(리밸런싱/수수료/환헤지)를 “옵션”으로 명확히 분리

- P2-C1. 리밸런싱 규칙 구현(월/분기/연) + 거래일 기준 정렬
- P2-C2. 거래비용(수수료/슬리피지) 파라미터를 *보수적 기본값*으로 옵션화
- P2-C3. 다통화 처리(원화 기준)
  - FX 시계열 테이블 도입(USDKRW 등)
  - (선택) 환헤지 모드(OFF 기본) — 결과에 명시적 표시
- P2-C4. 포트폴리오 경로 저장량 최적화(샘플링/압축/요약 동시 제공)

**주의**
- 어떤 옵션도 “더 유리하다”라고 표현하지 않는다. “가정”으로만 제공.

### Epic P2-D. 관측가능성(Observability) & 운영 자동화
**목표**: 장애를 “발견-원인-복구”할 수 있는 최소 도구를 갖춘다.

- P2-D1. 배치/ETL 실행 로그 및 메트릭(성공/실패/소요시간/레코드수)
- P2-D2. API 메트릭(응답시간, 캐시 hit ratio, 오류율)
- P2-D3. 알림(슬랙/메일 등) — 실패/지연/결측 급증 시
- P2-D4. 파티션 선생성 + TTL 정리 작업 스케줄링(월초/주간)

### Epic P2-E. 리스크 “설명” 모듈(추천 금지 준수)
**목표**: 결과 해석을 돕되, 선택을 강요하지 않는 형태로 제공

- P2-E1. “위기 구간 태깅” (예: 2008, 2020, 2022 등) — 구간별 손실/회복 비교
- P2-E2. 최악 구간의 원인 설명(시장 하락/환율/특정 자산 비중) — **사실 기반**
- P2-E3. 사용자 입력(기간/손실한도)에 따른 “적합성”은 점수화 금지
  - 대신 “이 입력에서는 이런 리스크가 관측됨” 형태로 기술

---

## 4. 실행 순서(권장 로드맵)
### Step 1: 데이터 정책을 먼저 고정(P2-A)
- 거래일/결측/수정주가/환율 정책을 문서로 확정하고, 엔진이 그 정책을 따르도록 한다.

### Step 2: 시나리오 거버넌스(P2-B)
- 시나리오가 늘어나기 전에 버전/승인/감사를 넣어야 운영이 무너지지 않는다.

### Step 3: 엔진 현실 요소(P2-C)
- 리밸런싱/비용/환율은 모델 성격을 크게 바꾸므로 옵션화하고 응답에 가정을 명시한다.

### Step 4: 운영 자동화/관측(P2-D)
- 배치 실패와 데이터 지연은 ‘항상’ 생긴다. 알림과 재실행 루틴을 만든다.

### Step 5: 설명 모듈(P2-E)
- 마지막에 사용자 가치(해석)로 연결한다. 단, 추천으로 보이지 않게 설계한다.

---

## 5. 팀 운영 가이드(실무)
### 브랜치/릴리즈
- `main`: 배포 가능 상태 유지
- `release/*`: 단계별 릴리즈 브랜치(Phase 2 마일스톤 단위)
- `feature/*`: Epic/티켓 단위

### PR 체크리스트(필수)
- [ ] 금지어 스캔 통과
- [ ] API 응답에서 손실/회복 KPI가 최상단
- [ ] request_hash/engine_version/scenario_version이 응답에 포함
- [ ] 마이그레이션/DDL 변경 시 롤백 가이드 포함
- [ ] ETL 변경 시 품질 리포트 샘플 첨부

### 테스트 기준(최소)
- E2E 스모크: `/scenarios` → `/simulations/run` → `/simulations/{id}`
- 회귀 테스트: 동일 입력 2회 호출 결과 동일 + 캐시 hit 확인
- 데이터 품질 테스트: 결측률 임계치 초과 시 실패

---

## 6. “다음 단계 착수”를 위한 바로 실행 항목(오늘 할 일)
1) `docs/data_policy.md` 초안 작성(거래일/결측/수정주가/환율/배당)  
2) `거래일캘린더` 테이블 DDL/seed 설계  
3) 시나리오 버전/상태(DRAFT/ACTIVE) 컬럼 추가 설계  
4) 배치 실패 알림 채널 확정(슬랙/메일) + 실패 기준 정의

---

## 7. Phase 3 예고(간단)
Phase 2 완료 후 Phase 3는 “기능 확장” 중심이다.
- 유니버스 확대(자산군/국가/테마)
- 시나리오 팩(패키지) 운영
- 사용자별 실험(단, 추천/개인화 권유로 보이지 않게)
- 성능 최적화(벡터화/캐시/병렬화)
