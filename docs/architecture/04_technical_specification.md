# ForestoCompass ê¸°ìˆ  ëª…ì„¸ì„œ

**ë¬¸ì„œ ë²„ì „**: 1.0
**ì‘ì„±ì¼**: 2026-01-16
**ëŒ€ìƒ**: ìš´ì˜íŒ€, ê°ì‚¬íŒ€, ê°œë°œíŒ€, ì¸í”„ë¼íŒ€

---

## 1. ì‹œìŠ¤í…œ êµ¬ì„±

### 1.1 ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ForestoCompass ì•„í‚¤í…ì²˜                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  Frontend   â”‚   â”‚   Backend   â”‚   â”‚  Database   â”‚               â”‚
â”‚  â”‚  (React)    â”‚â—„â”€â–ºâ”‚  (FastAPI)  â”‚â—„â”€â–ºâ”‚ (PostgreSQL)â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚        â”‚                 â”‚                 â”‚                        â”‚
â”‚        â”‚                 â”‚                 â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   Vercel    â”‚   â”‚   Railway   â”‚   â”‚   Railway   â”‚               â”‚
â”‚  â”‚   (CDN)     â”‚   â”‚  (Server)   â”‚   â”‚    (DB)     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ê¸°ìˆ  ìŠ¤íƒ ìƒì„¸

| ê³„ì¸µ | ê¸°ìˆ  | ë²„ì „ | ë¼ì´ì„ ìŠ¤ |
|------|------|------|----------|
| Frontend | React | 18.x | MIT |
| Frontend | TypeScript | 5.x | Apache 2.0 |
| Frontend | Vite | 5.x | MIT |
| Backend | Python | 3.9+ | PSF |
| Backend | FastAPI | 0.100+ | MIT |
| Backend | SQLAlchemy | 2.x | MIT |
| Backend | Pydantic | 2.x | MIT |
| Database | PostgreSQL | 15+ | PostgreSQL |
| Auth | JWT (PyJWT) | 2.x | MIT |

---

## 2. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### 2.1 Phase 1 í…Œì´ë¸”

```sql
-- ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰ ê¸°ë¡
simulation_run (
    run_id BIGSERIAL PRIMARY KEY,
    request_hash VARCHAR(64) NOT NULL,
    engine_version VARCHAR(20),
    created_at TIMESTAMP DEFAULT NOW()
)

-- NAV ê²½ë¡œ (ì¼ë³„ ìì‚°ê°€ì¹˜)
simulation_path (
    path_id BIGSERIAL PRIMARY KEY,
    run_id BIGINT REFERENCES simulation_run(run_id),
    path_date DATE NOT NULL,
    nav NUMERIC(20,4) NOT NULL,
    daily_return NUMERIC(10,6)
)

-- ì‹œë‚˜ë¦¬ì˜¤ ì •ì˜
scenario (
    scenario_id VARCHAR(20) PRIMARY KEY,
    scenario_name VARCHAR(100),
    description TEXT
)
```

### 2.2 Phase 2 í…Œì´ë¸”

```sql
-- Epic B: ë¦¬ë°¸ëŸ°ì‹± ê·œì¹™
rebalancing_rule (
    rule_id SERIAL PRIMARY KEY,
    rule_name VARCHAR(50) NOT NULL,
    rule_type VARCHAR(20) NOT NULL,  -- PERIODIC, DRIFT
    frequency VARCHAR(20),            -- MONTHLY, QUARTERLY
    drift_threshold NUMERIC(5,4),
    cost_rate NUMERIC(6,4) DEFAULT 0.001,
    is_active BOOLEAN DEFAULT TRUE
)

-- Epic B: ë¦¬ë°¸ëŸ°ì‹± ì´ë²¤íŠ¸
rebalancing_event (
    event_id BIGSERIAL PRIMARY KEY,
    simulation_run_id BIGINT REFERENCES simulation_run(run_id) ON DELETE CASCADE,
    event_date DATE NOT NULL,
    trigger_type VARCHAR(20),
    turnover NUMERIC(10,6),
    cost_amount NUMERIC(20,4)
)

-- Epic D: ì„±ê³¼ ë¶„ì„ ê²°ê³¼
analysis_result (
    analysis_id BIGSERIAL PRIMARY KEY,
    simulation_run_id BIGINT REFERENCES simulation_run(run_id) ON DELETE CASCADE,
    rf_annual NUMERIC(8,6) DEFAULT 0.0,
    annualization_factor INTEGER DEFAULT 252,
    metrics_json JSONB NOT NULL,
    calculated_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(simulation_run_id, rf_annual, annualization_factor)
)
```

---

## 3. API ëª…ì„¸

### 3.1 ì¸ì¦ API

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì„¤ëª… |
|------------|--------|------|
| `/auth/login` | POST | ë¡œê·¸ì¸ (JWT ë°œê¸‰) |
| `/auth/register` | POST | íšŒì›ê°€ì… |
| `/auth/me` | GET | í˜„ì¬ ì‚¬ìš©ì ì •ë³´ |

### 3.2 ì‹œë®¬ë ˆì´ì…˜ API

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì„¤ëª… | Rate Limit |
|------------|--------|------|------------|
| `/backtest/scenario` | POST | ì‹œë‚˜ë¦¬ì˜¤ ì‹œë®¬ë ˆì´ì…˜ | 5/hour |
| `/backtest/scenario/{id}/path` | GET | NAV ê²½ë¡œ ì¡°íšŒ | 30/min |
| `/backtest/run` | POST | ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰ | 5/hour |
| `/backtest/compare` | POST | í¬íŠ¸í´ë¦¬ì˜¤ ë¹„êµ | 5/hour |

### 3.3 ë¦¬ë°¸ëŸ°ì‹± API (Phase 2)

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì„¤ëª… |
|------------|--------|------|
| `/backtest/rebalancing/rules` | GET | ê·œì¹™ ëª©ë¡ |
| `/backtest/rebalancing/rules/{id}` | GET | ê·œì¹™ ìƒì„¸ |
| `/backtest/scenario/{run_id}/rebalancing-events` | GET | ì´ë²¤íŠ¸ ì¡°íšŒ |

### 3.4 ì„±ê³¼ ë¶„ì„ API (Phase 2)

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì„¤ëª… |
|------------|--------|------|
| `/backtest/analysis/run/{run_id}` | GET | KPI ì¡°íšŒ |
| `/backtest/analysis/compare` | GET | ë‘ ì‹œë®¬ë ˆì´ì…˜ ë¹„êµ |

---

## 4. Feature Flag ì„¤ì •

### 4.1 í™˜ê²½ë³€ìˆ˜

```bash
# Phase 1 í”Œë˜ê·¸
USE_SIM_STORE=0           # PostgreSQL ì‹œë®¬ë ˆì´ì…˜ ì €ì¥ (0=SQLite, 1=PostgreSQL)
USE_SCENARIO_DB=0         # DB ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤ (0=í´ë°±, 1=DB)

# Phase 2 í”Œë˜ê·¸
USE_REBALANCING=0         # ë¦¬ë°¸ëŸ°ì‹± ê¸°ëŠ¥ (0=OFF, 1=ON)
DEFAULT_COST_RATE=0.001   # ê¸°ë³¸ ê±°ë˜ë¹„ìš©ë¥  (10bp)
MISSING_DATA_POLICY=SKIP  # ê²°ì¸¡ ë°ì´í„° ì •ì±… (SKIP, ZERO_RETURN)

# ë¹„í™œì„±í™”ëœ í”Œë˜ê·¸
FEATURE_RECOMMENDATION_ENGINE=0  # ì¶”ì²œ ì—”ì§„ (í•­ìƒ OFF)
```

### 4.2 í”Œë˜ê·¸ ìƒíƒœ í™•ì¸

```python
# config.pyì—ì„œ ì¶œë ¥
print(f"ğŸš© Feature Flag - Rebalancing (Phase 2): {'ENABLED' if use_rebalancing else 'DISABLED (Default)'}")
```

---

## 5. ë³´ì•ˆ ì„¤ì •

### 5.1 ì¸ì¦/ì¸ê°€

| í•­ëª© | ì„¤ì • |
|------|------|
| í† í° ìœ í˜• | JWT (HS256) |
| í† í° ë§Œë£Œ | 30ë¶„ |
| ë¹„ë°€ë²ˆí˜¸ í•´ì‹± | bcrypt |
| API Key (B2B) | SHA-256 í•´ì‹œ |

### 5.2 Rate Limiting

| ì—”ë“œí¬ì¸íŠ¸ ìœ í˜• | ì œí•œ |
|----------------|------|
| AI ë¶„ì„ (ì‹œë®¬ë ˆì´ì…˜) | 5íšŒ/ì‹œê°„ |
| ë°ì´í„° ì¡°íšŒ | 30íšŒ/ë¶„ |
| ì¸ì¦ | 10íšŒ/ë¶„ |

### 5.3 CORS ì„¤ì •

```python
allowed_origins = [
    "http://localhost:3000",
    "http://localhost:5173",
    "https://kingo-portfolio-*.vercel.app",
]
```

---

## 6. ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§

### 6.1 ë¡œê·¸ ë ˆë²¨

| í™˜ê²½ | ë ˆë²¨ | ì¶œë ¥ |
|------|------|------|
| Development | DEBUG | ì½˜ì†” |
| Production | INFO | íŒŒì¼ + ì½˜ì†” |
| Error | ERROR | íŒŒì¼ + ì•Œë¦¼ |

### 6.2 ë¡œê·¸ í¬ë§·

```python
logging.info(f"Scenario simulation - scenario: {scenario_id}, hash: {request_hash[:8]}..., cache_hit: {cache_hit}")
```

### 6.3 ì¶”ì  ì •ë³´

| í•„ë“œ | ì„¤ëª… |
|------|------|
| `request_hash` | ìš”ì²­ ê³ ìœ  ì‹ë³„ì |
| `engine_version` | ê³„ì‚° ì—”ì§„ ë²„ì „ |
| `cache_hit` | ìºì‹œ ì‚¬ìš© ì—¬ë¶€ |
| `calculated_at` | ê³„ì‚° ì‹œì  |

---

## 7. ë°°í¬ êµ¬ì„±

### 7.1 í™˜ê²½ë³„ ì„¤ì •

| í™˜ê²½ | Frontend | Backend | Database |
|------|----------|---------|----------|
| Development | localhost:5173 | localhost:8000 | SQLite |
| Staging | Vercel Preview | Railway Dev | Railway Dev |
| Production | Vercel | Railway | Railway |

### 7.2 ë°°í¬ í”„ë¡œì„¸ìŠ¤

```
1. ì½”ë“œ í‘¸ì‹œ â†’ GitHub
2. CI/CD íŠ¸ë¦¬ê±° â†’ Vercel/Railway
3. ìë™ ë¹Œë“œ/í…ŒìŠ¤íŠ¸
4. í™˜ê²½ë³„ ë°°í¬
```

---

## 8. ì¥ì•  ëŒ€ì‘

### 8.1 í´ë°± ì „ëµ

| ìƒí™© | í´ë°± ë™ì‘ |
|------|-----------|
| DB ì—°ê²° ì‹¤íŒ¨ | SQLite í´ë°± (dev) |
| ì‹œë‚˜ë¦¬ì˜¤ DB ì—†ìŒ | í•˜ë“œì½”ë”©ëœ ì‹œë‚˜ë¦¬ì˜¤ |
| ë¦¬ë°¸ëŸ°ì‹± í…Œì´ë¸” ì—†ìŒ | í”„ë¦¬ì…‹ ê·œì¹™ ë°˜í™˜ |
| ìºì‹œ ë¯¸ìŠ¤ | ì‹¤ì‹œê°„ ê³„ì‚° |

### 8.2 í—¬ìŠ¤ì²´í¬

```bash
# í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸
GET /health
GET /api/v1/health

# ì‘ë‹µ
{ "status": "healthy", "version": "1.0.0" }
```

---

## 9. ì„±ëŠ¥ ì§€í‘œ

### 9.1 ëª©í‘œ SLA

| ì§€í‘œ | ëª©í‘œ |
|------|------|
| ê°€ë™ë¥  | 99.9% |
| API ì‘ë‹µ ì‹œê°„ (p50) | < 200ms |
| API ì‘ë‹µ ì‹œê°„ (p99) | < 1000ms |
| ì‹œë®¬ë ˆì´ì…˜ ê³„ì‚° | < 3s |

### 9.2 ìºì‹± ì „ëµ

| ë°ì´í„° | ìºì‹œ TTL | ì €ì¥ì†Œ |
|--------|----------|--------|
| ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ | 7ì¼ | PostgreSQL |
| ì„±ê³¼ ë¶„ì„ | ì˜êµ¬ (íŒŒë¼ë¯¸í„°ë³„) | PostgreSQL |
| ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° | ì˜êµ¬ | PostgreSQL |

---

## 10. ê°ì‚¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 10.1 ë³´ì•ˆ ì ê²€

- [ ] JWT ì‹œí¬ë¦¿ í‚¤ ì •ê¸° êµì²´
- [ ] í™˜ê²½ë³€ìˆ˜ ì•”í˜¸í™” í™•ì¸
- [ ] Rate Limit ë¡œê·¸ ê²€í† 
- [ ] ë¹„ì •ìƒ ì ‘ê·¼ íŒ¨í„´ ëª¨ë‹ˆí„°ë§

### 10.2 ê·œì œ ì¤€ìˆ˜ ì ê²€

- [ ] ê¸ˆì§€ ìš©ì–´ ê²€ìƒ‰ (ì¶”ì²œ/ìœ ë¦¬/ìµœì )
- [ ] ë©´ì±… ë¬¸êµ¬ í‘œì‹œ í™•ì¸
- [ ] Feature Flag ìƒíƒœ í™•ì¸
- [ ] ê°ì‚¬ ë¡œê·¸ ë³´ê´€ í™•ì¸

### 10.3 ìš´ì˜ ì ê²€

- [ ] ë°±ì—… ì •ìƒ ë™ì‘
- [ ] í—¬ìŠ¤ì²´í¬ ì‘ë‹µ í™•ì¸
- [ ] ì—ëŸ¬ ë¡œê·¸ ê²€í† 
- [ ] ì„±ëŠ¥ ì§€í‘œ ëª¨ë‹ˆí„°ë§

---

*ë³¸ ë¬¸ì„œëŠ” ìš´ì˜/ê°ì‚¬ ëª©ì ì˜ ê³µì‹ ê¸°ìˆ  ëª…ì„¸ì„œì…ë‹ˆë‹¤.*
