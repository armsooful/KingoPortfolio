# Phase 7 평가 결과 저장/히스토리 정책

## 1. 목적
- 평가 결과의 재현성과 무결성을 보장한다.
- 동일 입력 → 동일 출력이 유지되는지 확인할 수 있게 한다.
- Phase 6 표현/비교 규칙 위반이 없도록 저장 레이어에서 방지한다.

## 2. 저장 대상
- 포트폴리오 평가 결과(Output Schema v2)
- 평가 입력 파라미터(기간/리밸런싱)
- 결과 해시(result_hash)로 무결성 확인

## 3. 저장 규칙
- 저장 시점: 평가 실행 성공 후 즉시 저장
- 결과 스키마: Output Schema v2 고정
- 결과 해시: `sha256(result_json)` 저장

## 4. 조회 정책
- 본인 소유 포트폴리오에 대해서만 조회 가능
- 동일 포트폴리오의 평가 이력은 최신순 정렬
- 기본 페이지네이션: `limit=50`, `offset=0`

## 5. 재현성 확인
- 동일 입력 재평가 시 `result_hash` 비교
- 불일치 발생 시 다음 조치:
  - 평가 엔진 버전 확인
  - 데이터 누락 여부 확인
  - 히스토리 재검증 로그 작성

## 6. 오류 처리 원칙
- 데이터 누락/불충분: 중립 오류 메시지 반환
- 자동 권유/판단 문구 포함 금지

## 7. 변경 관리
- Output Schema 변경 시 Phase 6 재검토 필수
- 평가 엔진 로직 변경 시 재현성 회귀 테스트 수행
