# Phase 9 릴리스 체크리스트

작성일: 2026-01-23
버전: v1.0

---

## 1. 환경 변수 설정 (Production)

### 1.1 필수 환경 변수

| 변수명 | 설명 | 기본값 | Prod 권장값 |
|--------|------|--------|-------------|
| `DATABASE_URL` | 데이터베이스 연결 문자열 | sqlite:///./kingo.db | PostgreSQL URL |
| `SECRET_KEY` | JWT 서명 키 | (기본값) | **32자 이상 랜덤 문자열** |
| `ALGORITHM` | JWT 알고리즘 | HS256 | HS256 |
| `ACCESS_TOKEN_EXPIRE_MINUTES` | 토큰 만료 시간(분) | 30 | 30 |

### 1.2 Feature Flags

| 변수명 | 설명 | 기본값 | Prod 권장값 |
|--------|------|--------|-------------|
| `FEATURE_RECOMMENDATION_ENGINE` | 추천 엔진 활성화 | **0 (비활성)** | **0 (비활성 유지)** |
| `USE_SIM_STORE` | 시뮬레이션 저장소 | 0 | 환경에 따라 |
| `USE_SCENARIO_DB` | 시나리오 DB | 0 | 환경에 따라 |
| `USE_REBALANCING` | 리밸런싱 엔진 | 0 | 환경에 따라 |

### 1.3 운영 설정

| 변수명 | 설명 | 기본값 | Prod 권장값 |
|--------|------|--------|-------------|
| `ENGINE_VERSION` | 엔진 버전 (결과 추적용) | 1.0.0 | 현재 버전 |
| `RESET_DB_ON_STARTUP` | 시작 시 DB 초기화 | false | **false** |
| `DEFAULT_COST_RATE` | 기본 비용률 | 0.001 | 0.001 |
| `MISSING_DATA_POLICY` | 결측 데이터 정책 | SKIP | SKIP |

### 1.4 알림 설정

| 변수명 | 설명 | 기본값 | Prod 권장값 |
|--------|------|--------|-------------|
| `OPS_ALERT_EMAIL_ENABLED` | 이메일 알림 | 1 | 1 |
| `OPS_ALERT_SLACK_ENABLED` | Slack 알림 | 0 | 1 (권장) |
| `OPS_ALERT_WEBHOOK_URL` | Slack Webhook URL | (없음) | 설정 필요 |

### 1.5 CORS 설정

| 변수명 | 설명 | Prod 권장값 |
|--------|------|-------------|
| `ALLOWED_ORIGINS` | 허용 Origin 목록 | 프로덕션 도메인만 |

---

## 2. 기능 활성화/비활성화 확인

### 2.1 비활성화 유지 필수

| 항목 | 환경변수 | 확인 사항 |
|------|----------|-----------|
| ✅ 추천 엔진 | `FEATURE_RECOMMENDATION_ENGINE=0` | 투자 추천 로직 비활성화 |

**검증 방법:**
```bash
# 앱 시작 로그에서 확인
🚩 Feature Flag - Recommendation Engine: DISABLED (Default)
```

### 2.2 Phase 7 기능 활성화 확인

| 기능 | API 엔드포인트 | 상태 |
|------|---------------|------|
| 포트폴리오 생성 | `POST /api/v1/phase7/portfolios` | ✅ 활성 |
| 평가 실행 | `POST /api/v1/phase7/evaluations` | ✅ 활성 |
| 이력 조회 | `GET /api/v1/phase7/evaluations` | ✅ 활성 |
| 비교 기능 | `POST /api/v1/phase7/compare` | ✅ 활성 |

---

## 3. 관리자 기능 접근 통제

### 3.1 RBAC 역할 체계

| 역할 | 설명 | 권한 |
|------|------|------|
| `ADMIN_VIEWER` | 조회 전용 | ADMIN_VIEW |
| `ADMIN_OPERATOR` | 실행/중단/재처리 | VIEW, RUN, STOP, REPLAY |
| `ADMIN_APPROVER` | 승인/버전 전환 | VIEW, APPROVE, ACTIVATE, ADJUST |
| `SUPER_ADMIN` | 전체 권한 | 모든 권한 |

### 3.2 접근 통제 체크리스트

- [ ] 관리자 API (`/api/v1/admin/*`)에 인증 필수
- [ ] 역할 기반 권한 검사 적용
- [ ] 일반 사용자 관리자 API 접근 차단
- [ ] 감사 로그 기록 활성화

---

## 4. 모니터링 및 장애 대응

### 4.1 모니터링 항목

| 항목 | 지표 | 임계치 |
|------|------|--------|
| API 응답 시간 | p95 latency | < 3초 |
| 오류율 | 5xx 비율 | < 1% |
| 평가 실행 시간 | 평균 실행 시간 | < 10초 |
| DB 연결 | 활성 연결 수 | < 80% |

### 4.2 알림 설정

| 이벤트 | 알림 채널 | 담당자 |
|--------|-----------|--------|
| 5xx 오류 발생 | Slack, Email | 운영팀 |
| 평가 실패 | Slack | 개발팀 |
| DB 연결 오류 | Slack, Email | 인프라팀 |
| Rate Limit 초과 | Slack | 운영팀 |

### 4.3 장애 대응 연락체계

| 단계 | 담당 | 연락처 | 대응 시간 |
|------|------|--------|-----------|
| L1 | 운영팀 | (작성 필요) | 15분 내 |
| L2 | 개발팀 | (작성 필요) | 30분 내 |
| L3 | 인프라팀 | (작성 필요) | 1시간 내 |

---

## 5. 배포 전 체크리스트

### 5.1 코드 검증

- [x] E2E 테스트 전체 통과 (62개)
- [x] 금지어 스캔 통과 (Phase 7 범위)
- [x] UI 구조 점검 완료
- [ ] 코드 리뷰 완료
- [ ] 보안 취약점 스캔 완료

### 5.2 환경 설정

- [ ] 환경 변수 설정 완료
- [ ] `FEATURE_RECOMMENDATION_ENGINE=0` 확인
- [ ] `SECRET_KEY` 프로덕션 값 설정
- [ ] `DATABASE_URL` 프로덕션 DB 연결
- [ ] CORS Origin 프로덕션 도메인 설정

### 5.3 데이터베이스

- [ ] 마이그레이션 스크립트 준비
- [ ] 백업 정책 확인
- [ ] 롤백 스크립트 준비

### 5.4 모니터링

- [ ] 로그 수집 설정
- [ ] 알림 채널 연결
- [ ] 대시보드 구성
- [ ] 장애 대응 연락체계 확정

---

## 6. 배포 절차

### 6.1 배포 순서

1. **Pre-Deploy**
   - [ ] 환경 변수 확인
   - [ ] DB 마이그레이션 준비
   - [ ] 롤백 플랜 확인

2. **Deploy**
   - [ ] 백엔드 배포
   - [ ] DB 마이그레이션 실행
   - [ ] 프론트엔드 배포

3. **Post-Deploy**
   - [ ] Smoke 테스트 실행
   - [ ] 로그 모니터링
   - [ ] 알림 채널 확인

### 6.2 Smoke 테스트

| 테스트 | 엔드포인트 | 예상 결과 |
|--------|-----------|-----------|
| 헬스체크 | `GET /health` | 200 OK |
| 인증 | `POST /api/auth/login` | 200 + JWT |
| 평가 API | `POST /api/v1/phase7/evaluations` | 201 Created |
| Disclaimer 포함 | 결과 응답 | `disclaimer_version: "v2"` |

---

## 7. 법적/규제 준수 확인

### 7.1 고지 문구

- [x] 결과 화면 하단 고정 문구 표시
- [x] `disclaimer_version` 결과에 포함
- [x] 금지 표현 사용 안 함 (Phase 7 범위)

### 7.2 비자문 명확화

- [x] 투자 권유/추천 표현 없음
- [x] 추천 엔진 비활성화 (`FEATURE_RECOMMENDATION_ENGINE=0`)
- [x] 결과 해석/판단 문구 없음

---

## 8. 롤백 기준

### 8.1 즉시 롤백 조건

| 조건 | 트리거 |
|------|--------|
| 5xx 오류율 > 5% | 5분간 지속 |
| 평가 API 전체 실패 | 즉시 |
| 법적 표현 이슈 발견 | 즉시 |
| 데이터 무결성 이슈 | 즉시 |

### 8.2 롤백 절차

→ `rollback_plan.md` 참조

---

## 9. 승인

| 역할 | 이름 | 서명 | 일자 |
|------|------|------|------|
| 개발 리드 | | | |
| QA 리드 | | | |
| 운영 리드 | | | |
| 프로젝트 매니저 | | | |

---

## 10. 버전 이력

| 버전 | 일자 | 변경 내용 |
|------|------|-----------|
| v1.0 | 2026-01-23 | 최초 작성 |
