<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif; line-height:1.6; color:#333; background-color:#f4f4f4; margin:0; padding:0;">
  <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="background-color:#f4f4f4;">
    <tr>
      <td align="center" style="padding:20px 0;">
        <table role="presentation" width="600" cellpadding="0" cellspacing="0" style="max-width:600px; width:100%; background:#ffffff; border-radius:10px; overflow:hidden;">

          <!-- 헤더 -->
          <tr>
            <td style="background:#667eea; color:white; padding:30px; text-align:center;">
              <h1 style="margin:0 0 5px 0; font-size:24px; color:white;">Foresto Compass 시장 요약</h1>
              <div style="font-size:14px; color:rgba(255,255,255,0.9);">{{ date }}</div>
            </td>
          </tr>

          <!-- 콘텐츠 -->
          <tr>
            <td style="padding:30px;">

              <!-- 주요 지수 -->
              <div style="color:#667eea; font-size:18px; font-weight:700; margin:0 0 12px 0; padding-bottom:8px; border-bottom:2px solid #e0e0f0;">주요 지수</div>
              <table role="presentation" width="100%" cellpadding="0" cellspacing="8" style="margin-bottom:16px;">
                {% for idx in indices %}
                {% if loop.index0 % 2 == 0 %}<tr>{% endif %}
                  <td width="50%" style="background:#f8f9fa; border-radius:8px; padding:12px; text-align:center;">
                    <div style="font-size:13px; color:#666; margin-bottom:4px;">{{ idx.name }}</div>
                    <div style="font-size:20px; font-weight:700; color:#333;">{{ "{:,.2f}".format(idx.value) }}</div>
                    <div style="font-size:14px; font-weight:600; margin-top:2px; {% if idx.changePercent > 0 %}color:#e53935;{% elif idx.changePercent < 0 %}color:#1e88e5;{% else %}color:#666;{% endif %}">
                      {% if idx.changePercent > 0 %}+{% endif %}{{ idx.change }} ({% if idx.changePercent > 0 %}+{% endif %}{{ idx.changePercent }}%)
                    </div>
                  </td>
                {% if loop.index0 % 2 == 1 or loop.last %}</tr>{% endif %}
                {% endfor %}
              </table>

              <!-- 상승 종목 -->
              <div style="color:#667eea; font-size:18px; font-weight:700; margin:24px 0 12px 0; padding-bottom:8px; border-bottom:2px solid #e0e0f0;">상승 종목 Top 3</div>
              <table width="100%" cellpadding="0" cellspacing="0" style="margin-bottom:16px;">
                <tr>
                  <th style="background:#f8f9fa; text-align:left; padding:8px 10px; font-size:13px; color:#666; border-bottom:2px solid #e0e0f0;">종목</th>
                  <th style="background:#f8f9fa; text-align:left; padding:8px 10px; font-size:13px; color:#666; border-bottom:2px solid #e0e0f0;">현재가</th>
                  <th style="background:#f8f9fa; text-align:left; padding:8px 10px; font-size:13px; color:#666; border-bottom:2px solid #e0e0f0;">등락률</th>
                </tr>
                {% for s in gainers %}
                <tr>
                  <td style="padding:8px 10px; font-size:14px; border-bottom:1px solid #f0f0f0;">{{ s.name }} <span style="color:#999;font-size:12px;">({{ s.symbol }})</span></td>
                  <td style="padding:8px 10px; font-size:14px; border-bottom:1px solid #f0f0f0;">{{ "{:,}".format(s.price) }}원</td>
                  <td style="padding:8px 10px; font-size:14px; border-bottom:1px solid #f0f0f0; color:#e53935; font-weight:600;">+{{ s.change }}%</td>
                </tr>
                {% endfor %}
              </table>

              <!-- 하락 종목 -->
              <div style="color:#667eea; font-size:18px; font-weight:700; margin:24px 0 12px 0; padding-bottom:8px; border-bottom:2px solid #e0e0f0;">하락 종목 Top 3</div>
              <table width="100%" cellpadding="0" cellspacing="0" style="margin-bottom:16px;">
                <tr>
                  <th style="background:#f8f9fa; text-align:left; padding:8px 10px; font-size:13px; color:#666; border-bottom:2px solid #e0e0f0;">종목</th>
                  <th style="background:#f8f9fa; text-align:left; padding:8px 10px; font-size:13px; color:#666; border-bottom:2px solid #e0e0f0;">현재가</th>
                  <th style="background:#f8f9fa; text-align:left; padding:8px 10px; font-size:13px; color:#666; border-bottom:2px solid #e0e0f0;">등락률</th>
                </tr>
                {% for s in losers %}
                <tr>
                  <td style="padding:8px 10px; font-size:14px; border-bottom:1px solid #f0f0f0;">{{ s.name }} <span style="color:#999;font-size:12px;">({{ s.symbol }})</span></td>
                  <td style="padding:8px 10px; font-size:14px; border-bottom:1px solid #f0f0f0;">{{ "{:,}".format(s.price) }}원</td>
                  <td style="padding:8px 10px; font-size:14px; border-bottom:1px solid #f0f0f0; color:#1e88e5; font-weight:600;">{{ s.change }}%</td>
                </tr>
                {% endfor %}
              </table>

              <!-- 뉴스 -->
              <div style="color:#667eea; font-size:18px; font-weight:700; margin:24px 0 12px 0; padding-bottom:8px; border-bottom:2px solid #e0e0f0;">시장 뉴스</div>
              {% for n in news %}
              <div style="padding:8px 0; {% if not loop.last %}border-bottom:1px solid #f0f0f0;{% endif %}">
                <a href="{{ n.url }}" style="color:#333; text-decoration:none; font-size:14px;">{{ n.title }}</a>
                <div style="font-size:12px; color:#999; margin-top:2px;">{{ n.source }} &middot; {{ n.publishedAt }}</div>
              </div>
              {% endfor %}

              {% if scored_stocks %}
              <!-- Compass Score 하이라이트 -->
              <div style="color:#667eea; font-size:18px; font-weight:700; margin:24px 0 12px 0; padding-bottom:8px; border-bottom:2px solid #e0e0f0;">Compass Score 하이라이트</div>
              {% for s in scored_stocks %}
              <table width="100%" cellpadding="0" cellspacing="0" style="margin-bottom:16px; border:1px solid #e0e0f0; border-radius:8px;">
                <tr>
                  <td style="padding:12px;">
                    <!-- 종목명 + 점수 배지 + 등급 -->
                    <table width="100%" cellpadding="0" cellspacing="0">
                      <tr>
                        <td style="padding:0; vertical-align:middle;">
                          <span style="font-size:15px; font-weight:700;">{{ s.name }}</span>
                          <span style="font-size:12px; color:#999;"> ({{ s.ticker }})</span>
                        </td>
                        <td style="padding:0; text-align:right; vertical-align:middle;">
                          <span style="display:inline-block; width:36px; height:36px; line-height:36px; border-radius:50%; color:white; font-weight:700; font-size:14px; text-align:center; {% if s.compass_score >= 70 %}background:#4caf50;{% elif s.compass_score >= 50 %}background:#ff9800;{% else %}background:#f44336;{% endif %}">{{ s.compass_score | int }}</span>
                          <span style="font-weight:600; font-size:16px; margin-left:4px; {% if s.compass_score >= 70 %}color:#4caf50;{% elif s.compass_score >= 50 %}color:#ff9800;{% else %}color:#f44336;{% endif %}">{{ s.grade }}</span>
                        </td>
                      </tr>
                    </table>
                    <!-- 4축 바 차트 -->
                    <table width="100%" cellpadding="0" cellspacing="0" style="margin-top:10px;">
                      {% set axes = [
                        ("재무", s.categories.financial, "#4caf50"),
                        ("밸류", s.categories.valuation, "#2196f3"),
                        ("기술", s.categories.technical, "#ff9800"),
                        ("리스크", s.categories.risk, "#9c27b0")
                      ] %}
                      {% for label, score, color in axes %}
                      <tr>
                        <td style="padding:3px 8px 3px 0; font-size:12px; color:#666; width:50px; white-space:nowrap;">{{ label }}</td>
                        <td style="padding:3px 0;">
                          <table width="100%" cellpadding="0" cellspacing="0">
                            <tr>
                              <td style="padding:0; width:100%;">
                                <div style="background:#f0f0f0; border-radius:4px; height:14px; width:100%;">
                                  {% if score is not none %}
                                  <div style="background:{{ color }}; border-radius:4px; height:14px; width:{{ score | int }}%;"></div>
                                  {% else %}
                                  <div style="background:#ddd; border-radius:4px; height:14px; width:0%;"></div>
                                  {% endif %}
                                </div>
                              </td>
                            </tr>
                          </table>
                        </td>
                        <td style="padding:3px 0 3px 8px; font-size:12px; font-weight:600; color:#333; width:30px; text-align:right;">{% if score is not none %}{{ score | int }}{% else %}-{% endif %}</td>
                      </tr>
                      {% endfor %}
                    </table>
                    <!-- 코멘터리 -->
                    {% if s.commentary %}
                    <div style="margin-top:8px; padding:8px 10px; background:#f8f9fa; border-radius:4px; font-size:12px; color:#555; line-height:1.5;">
                      {{ s.commentary }}
                    </div>
                    {% endif %}
                  </td>
                </tr>
              </table>
              {% endfor %}
              {% endif %}

              {% if score_movers %}
              <!-- Score 변동 주목 종목 -->
              <div style="color:#667eea; font-size:18px; font-weight:700; margin:24px 0 12px 0; padding-bottom:8px; border-bottom:2px solid #e0e0f0;">Score 변동 주목 종목</div>
              {% for m in score_movers %}
              <table width="100%" cellpadding="0" cellspacing="0" style="margin-bottom:12px; border:1px solid #e0e0f0; border-radius:8px;">
                <tr>
                  <td style="padding:12px;">
                    <table width="100%" cellpadding="0" cellspacing="0">
                      <tr>
                        <td style="padding:0; vertical-align:middle;">
                          {% if m.diff > 0 %}
                          <span style="color:#e53935; font-size:18px; font-weight:700;">&#9650;</span>
                          {% else %}
                          <span style="color:#1e88e5; font-size:18px; font-weight:700;">&#9660;</span>
                          {% endif %}
                          <span style="font-size:15px; font-weight:700; margin-left:4px;">{{ m.name }}</span>
                          <span style="font-size:12px; color:#999;"> ({{ m.ticker }})</span>
                        </td>
                        <td style="padding:0; text-align:right; vertical-align:middle;">
                          <span style="font-size:13px; color:#999;">{{ m.prev_score }}점</span>
                          <span style="font-size:13px; color:#666;"> &rarr; </span>
                          <span style="font-size:16px; font-weight:700;">{{ m.current_score }}점</span>
                          <span style="font-size:14px; font-weight:600; margin-left:4px; {% if m.diff > 0 %}color:#e53935;{% else %}color:#1e88e5;{% endif %}">
                            ({% if m.diff > 0 %}+{% endif %}{{ m.diff }})
                          </span>
                          <span style="font-size:13px; font-weight:600; margin-left:4px; {% if m.current_score >= 70 %}color:#4caf50;{% elif m.current_score >= 50 %}color:#ff9800;{% else %}color:#f44336;{% endif %}">{{ m.grade }}</span>
                        </td>
                      </tr>
                    </table>
                    {% if m.commentary %}
                    <div style="margin-top:6px; font-size:12px; color:#555; line-height:1.5;">
                      {{ m.commentary }}
                    </div>
                    {% endif %}
                  </td>
                </tr>
              </table>
              {% endfor %}
              {% endif %}

              <!-- 법적 고지 -->
              <div style="background:#fff3cd; border-left:4px solid #ffc107; padding:15px; margin-top:24px; font-size:12px; color:#856404; line-height:1.5;">
                <strong>법적 고지</strong><br>
                본 이메일은 교육 목적의 참고 자료이며, 자본시장과 금융투자업에 관한 법률(자본시장법) 제6조에 따른
                금융투자상품에 대한 투자 권유, 투자 추천, 투자 자문에 해당하지 않습니다.
                매수가격, 매도가격, 손절가, 목표가격 등 구체적 투자 판단을 제시하지 않습니다.
                Compass Score 등 수치는 과거 데이터 기반 교육용 지표이며, 미래 수익을 보장하지 않습니다.
                본 서비스는 자본시장법상 투자자문업·투자일임업에 해당하지 않으며,
                모든 투자 판단과 그에 따른 손익의 책임은 투자자 본인에게 있습니다.
              </div>

            </td>
          </tr>

          <!-- 푸터 -->
          <tr>
            <td style="background:#f8f9fa; padding:20px 30px; text-align:center; font-size:12px; color:#666;">
              <p style="margin:4px 0;">&copy; 2026 Foresto Compass. All rights reserved.</p>
              <p style="margin:4px 0;">이 이메일은 발신 전용입니다. 회신하지 마세요.</p>
              <p style="margin:4px 0;"><a href="{{ unsubscribe_url | default(frontend_url + '/profile') }}" style="color:#667eea; text-decoration:none;">구독 해제하기</a></p>
            </td>
          </tr>

        </table>
      </td>
    </tr>
  </table>
</body>
</html>
