# Project Compass Score — 수행 결과 보고서

> **프로젝트명**: Foresto Compass Score (종합 투자 학습 점수 시스템)
> **수행 기간**: 2026-02-12 ~ 2026-02-13
> **프로젝트 상태**: 핵심 기능 완료
> **최종 커밋**: `28b2de8`

---

## 1. 프로젝트 개요

### 1.1 배경

경쟁사 분석(`docs/strategy/foresto-competitive-strategy-report.md`)을 통해 StockMatrix, AlphaSquare, IntelliQuant, Quantus, Securities Plus 등 한국 핀테크 투자 서비스의 강점과 약점을 파악하였다. 그 결과, **재무 + 밸류에이션 + 기술적 분석 + 리스크를 하나의 점수로 통합**하는 서비스가 시장에 부재함을 확인하고, 이를 Foresto Compass의 핵심 차별점으로 설정하였다.

### 1.2 목표

| # | 목표 | 우선순위 |
|---|------|---------|
| 1 | 4개 영역 통합 점수 엔진 구축 (0-100점, 9단계 등급) | 1순위 |
| 2 | Tier 1 기술 지표 6개 추가 (Stochastic, ATR, ADX, OBV, MA정배열, 52주위치) | 2순위 |
| 3 | 일일 이메일에 Top 10 Score 카드 통합 | 3순위 |
| 4 | 종목 스크리너 페이지 (필터/정렬/페이지네이션) | 중기 |
| 5 | 관심 종목 관리 + 점수 변동 이메일 알림 | 중기 |
| 6 | AI 자동 해설 (commentary) 생성 | 추가 |
| 7 | 전체 종목 일괄 계산 + E2E 검증 | 최종 |

### 1.3 핵심 포지셔닝

> **"종합 투자 학습 플랫폼"** — 재무 + 기술 통합 점수는 시장 유일 차별점

---

## 2. 구현 결과

### 2.1 신규 파일 (10개)

| 파일 | 역할 | 코드 라인 |
|------|------|----------|
| `services/scoring_engine.py` | 종합 점수 엔진 (4개 카테고리 가중 평균) | 716 |
| `routes/screener.py` | 스크리너 API (필터/정렬/페이지네이션) | 138 |
| `routes/watchlist.py` | 관심 종목 CRUD API | 138 |
| `models/watchlist.py` | Watchlist ORM 모델 | 32 |
| `services/watchlist_alert_service.py` | 점수 변동 이메일 알림 서비스 | 185 |
| `templates/watchlist_alert_email.html` | 알림 이메일 템플릿 | — |
| `pages/StockScreenerPage.jsx` | 스크리너 페이지 UI | 333 |
| `pages/WatchlistPage.jsx` | 관심 종목 페이지 UI | 198 |
| `styles/StockScreener.css` | 스크리너 스타일 | 269 |
| `styles/Watchlist.css` | 관심 종목 스타일 | 255 |
| **합계** | | **3,262** |

### 2.2 수정 파일 (18개)

| 파일 | 주요 변경 내용 |
|------|--------------|
| `services/quant_analyzer.py` | Tier 1 기술 지표 6개 추가 (+401줄) |
| `routes/admin.py` | batch-compute, single compute API 추가 (+102줄) |
| `routes/stock_detail.py` | Compass Score 섹션 API 추가 (+99줄) |
| `services/market_email_service.py` | Top 10 Score 카드 통합 (+57줄) |
| `models/securities.py` | Stock 모델에 compass_score/grade/summary/commentary 컬럼 추가 |
| `models/user_preferences.py` | watchlist_alert_enabled 설정 추가 |
| `routes/market_subscription.py` | 알림 설정 토글 API |
| `pages/StockDetailPage.jsx` | Compass Score 섹션 + AI 심층 해설 버튼 (+110줄) |
| `pages/MarketDashboardPage.jsx` | 대시보드에 스크리너 연동 링크 |
| `services/api.js` | screener, watchlist, scoring API 함수 (+58줄) |
| `App.jsx` | /screener, /watchlist 라우트 등록 |
| `components/Header.jsx` | 네비게이션에 스크리너/관심종목 링크 |
| `styles/StockDetail.css` | Compass 섹션 스타일 (+177줄) |
| `styles/MarketDashboard.css` | 대시보드 Score 카드 스타일 (+148줄) |
| `templates/market_daily_email.html` | 이메일에 Score 카드 영역 추가 |
| `main.py` | 신규 라우터/모델 등록 |
| `routes/admin_market_email.py` | 이메일 서비스 연동 조정 |
| `CLAUDE.md` | 프로젝트 문서 업데이트 |

### 2.3 총 변경량

```
28 files changed, 3,879 insertions(+), 62 deletions(-)
```

---

## 3. Scoring Engine 설계

### 3.1 점수 체계

```
Compass Score (0-100) = 가중 평균
├── 재무 점수 (30%) ← FinancialAnalyzer
├── 밸류에이션 점수 (20%) ← ValuationAnalyzer
├── 기술 점수 (30%) ← QuantAnalyzer (technical_indicators)
└── 리스크 점수 (20%) ← QuantAnalyzer (risk_metrics)
```

### 3.2 재무 점수 (30%) — 100점 만점 → 비중 30%

| 지표 | 배점 | 기준 |
|------|------|------|
| ROE | 30 | ≥15%→30, ≥10%→24, ≥5%→16, ≥0%→8, <0→0 |
| 영업이익률 | 25 | ≥20%→25, ≥10%→20, ≥5%→13, ≥0%→6, <0→0 |
| 부채비율 | 25 | ≤50%→25, ≤100%→20, ≤200%→13, ≤400%→6, >400%→0 |
| 순이익률 | 20 | ≥15%→20, ≥10%→16, ≥5%→10, ≥0%→4, <0→0 |

### 3.3 밸류에이션 점수 (20%) — 100점 만점 → 비중 20%

| 지표 | 배점 | 기준 |
|------|------|------|
| PER vs 업종 평균 | 50 | 20%+ 저평가→50, ±20%→30, 20%+ 고평가→10 |
| PBR vs 업종 평균 | 50 | 20%+ 저평가→50, ±20%→30, 20%+ 고평가→10 |

### 3.4 기술 점수 (30%) — 100점 만점 → 비중 30%

| 카테고리 | 지표 | 배점 |
|---------|------|------|
| 추세 (40점) | MA 정배열 | 20 |
| | ADX | 20 |
| 모멘텀 (40점) | RSI | 15 |
| | Stochastic | 10 |
| | MACD | 15 |
| 위치/거래량 (20점) | 52주 위치 | 10 |
| | OBV 추세 | 10 |

### 3.5 리스크 점수 (20%) — 높을수록 안정 → 비중 20%

| 지표 | 배점 | 기준 |
|------|------|------|
| 변동성(연율) | 35 | <20%→35, <30%→28, <50%→18, <80%→8, ≥80%→0 |
| MDD | 35 | >-10%→35, >-20%→28, >-30%→18, >-50%→8, ≤-50%→0 |
| 샤프비율 | 30 | >2.0→30, >1.0→24, >0→15, >-1.0→6, ≤-1.0→0 |

### 3.6 등급 체계 (9단계)

| 점수 범위 | 등급 | 설명 |
|----------|------|------|
| 90-100 | S | 최상위 — 매우 우수 |
| 80-89 | A+ | 상위 — 우수 |
| 70-79 | A | 양호 |
| 60-69 | B+ | 보통 이상 |
| 50-59 | B | 보통 |
| 40-49 | C+ | 주의 |
| 30-39 | C | 약세 |
| 20-29 | D | 위험 |
| 0-19 | F | 매우 위험 |

### 3.7 N/A 카테고리 처리

데이터가 없는 카테고리는 제외하고, 남은 카테고리 가중치를 비례 재분배한다.

예: 재무 데이터 없는 종목 → 밸류(20/70) + 기술(30/70) + 리스크(20/70)으로 재계산

---

## 4. 데이터 적재 결과

### 4.1 전체 현황

| 항목 | 값 |
|------|-----|
| 총 종목 수 | 2,886 |
| 점수 계산 성공 | **2,872** (99.5%) |
| 계산 실패 | 14 (0.5%) |
| AI 해설 생성 | 2,872 (100%) |
| 전체 평균 점수 | **66.9점** |
| 표준편차 | 12.6 |
| 소요 시간 | 약 80분 |

### 4.2 시장별 분포

| 시장 | 종목 수 | 계산 완료 | 평균 점수 |
|------|---------|----------|----------|
| KOSDAQ | 1,770 | 1,765 | 66.6 |
| KOSPI | 954 | 951 | 69.6 |
| KONEX | 112 | 106 | 50.0 |
| KOSDAQ GLOBAL | 49 | 49 | 64.1 |

### 4.3 등급별 분포

| 등급 | 종목 수 | 비율 | 점수 범위 |
|------|---------|------|----------|
| S | 54 | 1.9% | 100.0 |
| A+ | 245 | 8.5% | 80.0 ~ 89.8 |
| A | 1,029 | 35.8% | 70.0 ~ 79.9 |
| B+ | 835 | 29.1% | 60.0 ~ 69.9 |
| B | 382 | 13.3% | 50.0 ~ 59.9 |
| C+ | 248 | 8.6% | 40.0 ~ 49.9 |
| C | 64 | 2.2% | 30.0 ~ 39.9 |
| D | 14 | 0.5% | 20.0 ~ 28.5 |
| F | 1 | 0.03% | 8.0 |

> 상위 등급(S~A): 46.2%, 중위(B+~B): 42.4%, 하위(C+~F): 11.4%
> 정규분포에 가까운 건전한 분포를 보임

---

## 5. 기능별 E2E 검증 결과

### 5.1 종목 스크리너 (`/screener`)

| 테스트 항목 | 결과 |
|-----------|------|
| 페이지 로드 + 2,872건 표시 | PASS |
| 시장 필터 (KOSPI/KOSDAQ/KONEX) | PASS |
| 섹터 필터 (25개 섹터) | PASS |
| 등급 필터 (S~F) | PASS |
| 점수 범위 필터 (최소~최대) | PASS |
| 컬럼 정렬 (Score, 현재가, 시총, PER, PBR, 배당률) | PASS |
| 페이지네이션 (144페이지) | PASS |
| 관심 종목 추가 (별 아이콘) | PASS |
| 종목 클릭 → 상세 페이지 이동 | PASS |

### 5.2 관심 종목 (`/watchlist`)

| 테스트 항목 | 결과 |
|-----------|------|
| 페이지 로드 + 빈 상태 표시 | PASS |
| "스크리너에서 추가하기" 버튼 동작 | PASS |
| 관심 종목 목록 표시 (Score, 등급, 요약) | PASS |
| 종목 삭제 (✕ 버튼) | PASS |
| 이메일 알림 토글 UI | PASS |

### 5.3 종목 상세 — Compass 섹션 (`/admin/stock-detail`)

| 테스트 항목 | 결과 |
|-----------|------|
| 삼성전자(005930) Score 68.8점 B+ 표시 | PASS |
| 4개 카테고리 점수 (재무 74.5, 밸류 60, 기술 64, 리스크 76) | PASS |
| 요약 문구 표시 | PASS |
| AI 해설 (3~5문장) 표시 | PASS |
| AI 심층 해설 버튼 | PASS |
| 면책 고지 표시 | PASS |

### 5.4 빌드 검증

| 항목 | 결과 |
|------|------|
| `npm run build` | PASS (33.79초, 167 모듈) |
| 번들 크기 | JS 666KB, CSS 165KB |

---

## 6. 아키텍처

### 6.1 점수 계산 흐름

```
[Admin] POST /admin/scoring/batch-compute
    └→ BackgroundTask
        └→ for each stock:
            ├→ FinancialAnalyzer.analyze_stock()
            ├→ ValuationAnalyzer.compare_multiples()
            ├→ QuantAnalyzer.comprehensive_quant_analysis()
            └→ ScoringEngine.calculate_compass_score()
                ├→ _score_financial() → 0-100
                ├→ _score_valuation() → 0-100
                ├→ _score_technical() → 0-100
                ├→ _score_risk() → 0-100
                ├→ 가중 평균 → compass_score
                ├→ _determine_grade() → compass_grade
                ├→ _generate_summary() → compass_summary
                └→ _generate_commentary() → compass_commentary
```

### 6.2 데이터 모델

```sql
-- stocks 테이블에 추가된 컬럼
compass_score       FLOAT       -- 종합 점수 (0-100)
compass_grade       VARCHAR(5)  -- 등급 (S, A+, A, B+, B, C+, C, D, F)
compass_summary     TEXT        -- 한줄 요약
compass_commentary  TEXT        -- 3-5문장 AI 해설
compass_updated_at  TIMESTAMP   -- 마지막 산출 시각

-- 신규 테이블
watchlist (
    id, user_id, ticker, added_at,
    prev_score, prev_grade, score_changed_at
)
```

### 6.3 API 엔드포인트 (신규)

| Method | Path | 설명 |
|--------|------|------|
| POST | `/admin/scoring/compute?ticker=` | 단일 종목 점수 계산 |
| POST | `/admin/scoring/batch-compute?limit=` | 전체 일괄 계산 |
| GET | `/screener/stocks` | 스크리너 (필터/정렬/페이지네이션) |
| GET | `/screener/markets` | 시장 목록 |
| GET | `/screener/sectors` | 섹터 목록 |
| GET | `/watchlist` | 관심 종목 목록 |
| POST | `/watchlist` | 관심 종목 추가 |
| DELETE | `/watchlist/{ticker}` | 관심 종목 삭제 |
| GET | `/stock-detail/{ticker}/compass` | 종목 Compass Score 상세 |

---

## 7. 기술 지표 추가 내역 (quant_analyzer.py)

### 7.1 기존 지표 (Phase 3 이전)

- SMA (5, 20, 60, 120일)
- RSI (14일)
- Bollinger Bands (20일, 2σ)
- MACD (12, 26, 9)
- 변동성 (연율화)
- MDD (Maximum Drawdown)
- 샤프비율
- 베타
- 알파
- VaR (95%)

### 7.2 Tier 1 추가 지표 (이번 프로젝트)

| 지표 | 파라미터 | 점수 반영 | 설명 |
|------|---------|----------|------|
| **Stochastic** | K=14, D=3 | 모멘텀 10점 | 과매수/과매도 판단 |
| **ATR** | 14일 | 리스크 참조 | 변동폭 측정 |
| **ADX** | 14일 | 추세 20점 | 추세 강도 (방향 무관) |
| **OBV** | — | 거래량 10점 | 거래량 기반 추세 확인 |
| **MA 정배열/역배열** | 5, 20, 60일 | 추세 20점 | 이평선 배열 상태 |
| **52주 위치** | 250거래일 | 위치 10점 | 52주 고/저 대비 현재 위치 |

---

## 8. 경쟁사 대비 차별점

| 기능 | StockMatrix | AlphaSquare | Quantus | **Foresto Compass** |
|------|-------------|-------------|---------|---------------------|
| 종합 점수 | X | 부분적 | X | **S~F 9단계** |
| 재무 분석 통합 | X | O | O | **O (30% 반영)** |
| 밸류에이션 | X | 부분적 | O | **O (20% 반영)** |
| 기술 지표 | 30개 | 기본 | 다수 | **16개 (10+6)** |
| 리스크 지표 | X | X | 부분적 | **O (20% 반영)** |
| AI 해설 | X | X | X | **O (자동 생성)** |
| 이메일 뉴스레터 | O | X | X | **O (Score 카드)** |
| 종목 스크리너 | X | O | O | **O** |
| 관심 종목 알림 | X | O | X | **O** |
| 가격 | 무료 | 유료 | 유료 | **무료** |

> **핵심 차별점**: 재무 + 밸류 + 기술 + 리스크 4개 축을 하나의 점수로 통합하고, AI 해설까지 자동 생성하는 서비스는 한국 시장에 부재

---

## 9. 장기 과제 (Future Roadmap)

### 9.1 종목 비교 기능

**목표**: 2개 이상의 종목을 나란히 비교하여 학습 효과를 극대화

| 세부 항목 | 설명 | 예상 난이도 |
|----------|------|-----------|
| 비교 선택 UI | 스크리너에서 체크박스로 2~5개 종목 선택 | 중 |
| 비교 대시보드 | 레이더 차트 (4개 카테고리), 세부 지표 테이블 | 중 |
| 점수 히스토리 비교 | 시간에 따른 점수 변화 추이 라인 차트 | 상 |
| 업종 내 순위 | 동일 섹터 내 상대적 위치 표시 | 중 |
| PDF 비교 리포트 | 기존 pdf_report_generator 확장 | 하 |

**기대 효과**: 투자 학습에서 "왜 A 종목이 B보다 높은 점수인가?"를 시각적으로 이해

### 9.2 모바일 PWA (Progressive Web App)

**목표**: 모바일 환경에서 앱 수준의 사용 경험 제공

| 세부 항목 | 설명 | 예상 난이도 |
|----------|------|-----------|
| Service Worker | 오프라인 캐싱, 백그라운드 동기화 | 상 |
| Web App Manifest | 홈 화면 설치, 스플래시 스크린 | 하 |
| Push Notification | 점수 변동 알림 (FCM 연동) | 상 |
| 반응형 최적화 | 현재 CSS 기반 → 모바일 퍼스트 재설계 | 중 |
| 오프라인 Score 조회 | IndexedDB에 최근 조회 종목 캐싱 | 중 |

**기대 효과**: 출퇴근 시간 등 모바일 환경에서의 접근성 향상, 재방문율 증가

### 9.3 점수 고도화

| 세부 항목 | 설명 | 예상 난이도 |
|----------|------|-----------|
| 점수 히스토리 테이블 | 일별 점수 변화 기록 (트렌드 분석) | 중 |
| 업종별 상대 점수 | 동일 업종 내 백분위 기반 정규화 | 중 |
| Tier 2 지표 추가 | VWAP, 이격도, 투자심리선, 엔벨로프 | 중 |
| 매크로 지표 반영 | 금리, 환율, 유가 등 거시 환경 가중치 | 상 |
| ML 기반 가중치 | 과거 데이터 기반 최적 가중치 학습 | 상 |

### 9.4 사용자 경험 개선

| 세부 항목 | 설명 | 예상 난이도 |
|----------|------|-----------|
| 스크리너 고급 필터 | 재무 지표별 범위 필터 (ROE > 10% 등) | 중 |
| 커스텀 가중치 | 사용자가 4개 카테고리 비중 조절 | 중 |
| 알림 조건 커스터마이즈 | "A+ 이상 종목 등장 시 알림" 등 | 중 |
| 포트폴리오 연동 | 보유 포트폴리오의 가중 Compass Score | 중 |
| 다국어 지원 | 영문 UI + 해설 | 하 |

### 9.5 SEO / 마케팅 연동

| 세부 항목 | 설명 | 예상 난이도 |
|----------|------|-----------|
| 공개 스크리너 페이지 | 비로그인 사용자도 상위 10개 확인 가능 | 하 |
| 교육 콘텐츠 페이지 | "Compass Score란?", 지표 설명 등 | 하 |
| 소셜 공유 카드 | 종목별 Score 카드 이미지 자동 생성 (OG Image) | 중 |
| 뉴스레터 랜딩 | StockMatrix 스타일 카운트다운 CTA | 하 |

---

## 10. 알려진 제한 사항

| 항목 | 설명 | 영향도 |
|------|------|-------|
| S등급 과다 (54개) | PBR < 1 종목에 밸류 점수 최대치 부여 → S등급 집중 | 중 |
| KONEX 평균 50점 | 재무 데이터 부재 종목이 많아 기술+리스크만으로 계산 | 하 |
| 점수 정적 | 배치 실행 시점의 스냅샷, 실시간 변동 미반영 | 중 |
| 14개 종목 실패 | 시세 데이터 완전 부재 (상장 직후 등) | 하 |
| 해설 템플릿 기반 | LLM이 아닌 규칙 기반 자동 생성 → 문장 다양성 제한 | 하 |

---

## 11. 결론

Project Compass Score는 **1순위~3순위 및 중기 목표를 모두 달성**하였다.

- **2,872개 종목**에 대해 4개 영역 통합 점수 + 9단계 등급 + AI 해설을 완전 자동 산출
- 종목 스크리너, 관심 종목, 이메일 Score 카드까지 End-to-End 파이프라인 완성
- 경쟁사 대비 **재무+기술 통합 점수**라는 시장 유일의 차별점 확보

장기 과제(종목 비교, 모바일 PWA, 점수 고도화)는 핵심 인프라가 갖추어졌으므로, 사용자 피드백을 반영하여 점진적으로 확장 가능하다.

---

> **면책 고지**: 본 시스템은 교육 목적 참고 정보이며 투자 권유가 아닙니다. 모든 투자 결정은 이용자의 판단과 책임 하에 이루어집니다.
